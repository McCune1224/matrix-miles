services:
  # Strava Server Application
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: strava-server
    ports:
      - "8080:8080"
    environment:
      # Server Configuration
      PORT: ${PORT:-8080}
      DOMAIN: ${DOMAIN:-http://localhost:8080}
      
      # Database Configuration (from Railway)
      DB_HOST: ${DB_HOST}
      DB_PORT: ${DB_PORT}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_NAME: ${DB_NAME}
      DB_SSLMODE: ${DB_SSLMODE:-require}
      
      # Strava API Credentials
      STRAVA_CLIENT_ID: ${STRAVA_CLIENT_ID}
      STRAVA_CLIENT_SECRET: ${STRAVA_CLIENT_SECRET}
      STRAVA_REDIRECT_URI: ${STRAVA_REDIRECT_URI:-http://localhost:8080/auth/callback}
      
      # Security
      ESP32_API_KEY: ${ESP32_API_KEY}
      ADMIN_USERNAME: ${ADMIN_USERNAME:-admin}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD:-changeme}
    restart: unless-stopped
